# 数据库
##事务
定义：是满足ACID的一组操作
## ACID
A（atomicity） 原子性

C (consistency)一致性

I (isolation)隔离性

D (durability)持久性

mysql默认使用自动提交（AUTOCOMMIT），会把每一个操作当作事务执行
## 并发一致性问题
**丢失修改**     一个事务的更新操作被另一个事务所覆盖（替换）

**脏读**         一个事务读到另一个事务未提交的数据

**不可重复读**    一个事务多次读取一处数据集合，在此期间有别的事务对该数据集合做了修改，导致本事务前后读取数据不一致

**幻读**          当某个事务读取某个范围内的记录时，另外一个事务又在该范围内插入了新的记录，当之前的事务又再次读取该范围的记录时，会产生 幻读（Phantom Read）。
## 事务隔离级别
**未提交读**       一个事务可以读取别的事务还没提交的数据

**提交读**         保证一个事务只能读取到其他事务已经提交的数据

**可重复读**       保证一个事务在读取一个数据集合时，多次读取的结果相同

**串行化**         强制事务串行执行，缺点是并发性很差
## 数据库锁
### 读写锁
类似互斥锁（exclusive）与共享锁（shared）

一个事务获取了某个数据集合的X锁，其他事务不能对该数据集合加锁

一个事务获取了某个数据集合的S锁，其他事务可以加S锁但是不可以加X锁
### 表级锁，行级锁与封锁粒度
表级锁：锁定整张表

行级锁：锁定该行

锁粒度越小，并发程度越高，同时由于锁的各种操作会增加系统开销，因此系统开销越打

选择锁粒度时，要在并发程度与系统开销之间权衡
### 意向锁
当存在表级锁和行级锁的情况下，必须先申请意向锁（IX/IS）（表级锁，但不是真的加锁），再获取行级锁。这样可以避免在已经存在行级锁的时候一行行检测有无行级锁的存在
### 悲观锁与乐观锁
并发控制的两种手段，在数据库中具体表现为

悲观锁：使用锁操作

乐观锁：使用version版本号与时间戳，假设不会发生并发冲突，只在提交操作时检查是否违反数据完整性。
### MVCC
多版本并发控制（Multi-Version-Concurrent-Control）

写操作更新最新的版本快照，而读操作去读旧版本快照
